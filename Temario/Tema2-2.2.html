<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Practica 2.2</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  
  <h2>Autenticación en Nginx</h2>

  <p>Vamos a utilizar openssl y comprobamos si está instalada:</p>
  <pre><code>dpkg -l | grep openssl
  </code></pre>

  <p>Ahora creamos un archivo oculto .htpasswd en <code>/etc/nginx</code>:</p>
  <pre><code>sudo sh -c  "echo -n 'abhijeet:' &gt;&gt; /etc/nginx/.htpasswd"
  </code></pre>

  <p>Crea dos usuarios, uno con tu nombre y otro con tu apellido. Comprueba que el usuario y la contraseña aparezcan cifrados en el fichero:</p>
  <pre><code>cat /etc/nginx/.htpasswd
  </code></pre>

  <h4>Configurando el servidor Nginx para usar autenticación básica</h4>
  <p>Editamos el archivo de server block:</p>
  <pre><code>sudo nano /etc/nginx/sites-available/nom_web
  </code></pre>

  <p>Y editamos dentro de <code>location / {...}</code>:</p>
  <pre><code>server {
      listen 80;
      listen [::]:80;

      root /var/www/abhijeet/html/perfect-learn;
      index index.html index.htm index.nginx-debian.html;
      server_name tasca;
      location / {
        auth_basic "Àrea restringida";
        auth_basic_user_file /etc/nginx/.htpasswd;
        try_files $uri $uri/ =404;
      }
  }
  </code></pre>

  <p>Y reiniciamos el servidor:</p>
  <pre><code>sudo systemctl restart nginx
  </code></pre>

  <h4>Combinación de la autenticación básica con restricciones de IP</h4>
  <p>Dentro de server block añadiremos:</p>
  <pre><code>server {
      ...
      location / {
        deny 198.192.1.10;
        allow 192.168.1.1/24,
        allow 127.0.0.1;
        deny all;
      }
  }
  </code></pre>

  <p>Combinar IP y la autenticación HTTP:</p>
  <pre><code>server {
      ...
      location / {
        satisfy all;

        deny 198.192.1.10;
        allow 192.168.1.1/24,
        allow 127.0.0.1;
        deny all;

        auth_basic              "Administrator's area"
        auth_basic_user_file    conf/htpasswd;
      }
  }
  </code></pre>
</body>
</html>